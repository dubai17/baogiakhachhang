<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Tính Giá Sản Phẩm Tự Động</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Thiết lập font Inter cho giao diện */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        
        /* Kích thước cột cố định để gọn gàng hơn */
        .col-stt { width: 40px; }
        .col-action { width: 70px; }
        .col-ma-sp { width: 150px; } /* Cố định chiều rộng Mã SP */
        .col-price { width: 100px; } /* Cố định chiều rộng các cột giá (NPP, GIÁ, TK) */
        
        /* Style cho input TK (Giá Gốc) */
        .input-tk {
            font-weight: bold;
            text-align: right;
            border-color: #34d399; /* Xanh lá */
            color: #16a34a; /* Xanh lá đậm cho chữ */
        }
        
        /* Style chung cho ô hiển thị giá đã tính (cả các ô không phải input và ô input NPP) */
        .input-calculated-price {
            font-weight: bold;
            text-align: right;
            color: #1f2937; /* Màu chữ gần như đen (Gray-800) */
            background-color: transparent; /* Loại bỏ màu nền */
            border: none; /* Loại bỏ viền */
            padding: 0; /* Loại bỏ padding để khớp với text content */
            height: auto; /* Loại bỏ chiều cao cố định */
            
            /* Đảm bảo khi focus vẫn giữ vẻ ngoài "giống text" */
            box-shadow: none;
            outline: none;
            transition: none;
        }

        /* Thêm style cho ô nhập liệu NPP để nó vẫn giống như một ô text, nhưng có thể nhập được */
        .input-npp-editable {
            /* Kế thừa giao diện giống text, chỉ khác là cho phép focus và có placeholder */
            /* Dùng border bottom mỏng để đánh dấu là input khi focus */
            border-bottom: 1px solid transparent; 
            transition: border-color 0.15s ease-in-out;
            text-align: right; /* Căn phải cho cột giá */
        }

        .input-npp-editable:focus {
            border-bottom-color: #60a5fa; /* Blue-400 */
        }
        
        /* Style mới cho cột MÃ SP (Product Code) - Giống text/NPP nhưng căn trái */
        .input-product-code {
            text-align: left;
            font-weight: 600; /* Medium bold */
            color: #1f2937; /* Màu chữ gần như đen */
            background-color: transparent; /* Loại bỏ màu nền */
            border: none; /* Loại bỏ viền */
            padding: 0; 
            height: auto; 
            box-shadow: none;
            outline: none;
            transition: none;
            
            /* Thêm viền dưới khi focus để người dùng biết là ô nhập liệu */
            border-bottom: 1px solid transparent; 
            transition: border-color 0.15s ease-in-out;
        }

        .input-product-code:focus {
            border-bottom-color: #60a5fa; /* Blue-400 */
        }

        /* Class để ẩn các cột khi cần */
        .hidden-col {
            display: none !important;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto bg-white p-6 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-6 border-b-4 border-emerald-500 pb-2">
            Bảng Tính Giá Tự Động
        </h1>
        
        <!-- Bảng được đặt trong div có overflow-x-auto để hỗ trợ responsive trên di động -->
        <div class="overflow-x-auto">
            <table id="priceTable" class="min-w-full divide-y divide-gray-200">
                <!-- Tiêu đề Bảng -->
                <thead class="bg-emerald-600 text-white">
                    <tr>
                        <th scope="col" class="col-stt px-3 py-3 text-xs font-medium uppercase tracking-wider rounded-tl-lg">STT</th>
                        <th scope="col" class="col-ma-sp px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">MÃ SP</th>

                        <!-- Cột NPP (Đã đổi tên và là cột nhập liệu) -->
                        <th id="header-npp-manual" scope="col" class="col-price px-3 py-3 text-right text-xs font-medium uppercase tracking-wider relative group">
                            NPP
                            <button onclick="toggleColumn('npp-manual')" class="absolute top-1 right-1 p-0.5 bg-emerald-700/50 rounded-full group-hover:bg-emerald-700 transition duration-150">
                                <svg id="icon-npp-manual" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </th>
                        
                        <!-- Cột GIÁ (10%) -->
                        <th id="header-gia" scope="col" class="col-price px-3 py-3 text-right text-xs font-medium uppercase tracking-wider relative group">
                            GIÁ
                            <button onclick="toggleColumn('gia')" class="absolute top-1 right-1 p-0.5 bg-emerald-700/50 rounded-full group-hover:bg-emerald-700 transition duration-150">
                                <svg id="icon-gia" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </th>
                        
                        <!-- Cột NPP 1 (15%) -->
                        <th id="header-npp1" scope="col" class="col-price px-3 py-3 text-right text-xs font-medium uppercase tracking-wider relative group">
                            NPP 1
                            <button onclick="toggleColumn('npp1')" class="absolute top-1 right-1 p-0.5 bg-emerald-700/50 rounded-full group-hover:bg-emerald-700 transition duration-150">
                                <svg id="icon-npp1" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </th>
                        
                        <!-- Cột NPP 2 (20%) -->
                        <th id="header-npp2" scope="col" class="col-price px-3 py-3 text-right text-xs font-medium uppercase tracking-wider relative group">
                            NPP 2
                            <button onclick="toggleColumn('npp2')" class="absolute top-1 right-1 p-0.5 bg-emerald-700/50 rounded-full group-hover:bg-emerald-700 transition duration-150">
                                <svg id="icon-npp2" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </th>
                        
                        <!-- Cột NPP 3 (30%) -->
                        <th id="header-npp3" scope="col" class="col-price px-3 py-3 text-right text-xs font-medium uppercase tracking-wider relative group">
                            NPP 3
                            <button onclick="toggleColumn('npp3')" class="absolute top-1 right-1 p-0.5 bg-emerald-700/50 rounded-full group-hover:bg-emerald-700 transition duration-150">
                                <svg id="icon-npp3" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </th>

                        <th scope="col" class="col-price px-3 py-3 text-right text-xs font-medium uppercase tracking-wider bg-emerald-700">TK (Giá Gốc)</th>
                        <th scope="col" class="col-action px-3 py-3 text-xs font-medium uppercase tracking-wider rounded-tr-lg">Thao tác</th>
                    </tr>
                </thead>
                <!-- Nội dung Bảng -->
                <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Dữ liệu trống sẽ được thêm bằng JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Các nút chức năng toàn cục -->
        <div class="mt-6 flex flex-col md:flex-row md:justify-end md:items-center space-y-3 md:space-y-0 md:space-x-4">
            
            <div class="flex space-x-2">
                <button onclick="toggleAllColumns(false)" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md text-sm">
                    Ẩn Tất Cả Giá
                </button>
                <button onclick="toggleAllColumns(true)" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md text-sm">
                    Hiện Tất Cả Giá
                </button>
            </div>

            <button onclick="addRow()" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                Thêm Dòng Sản Phẩm
            </button>
            <p class="text-sm text-gray-500 italic hidden md:block">Giá được làm tròn tới đơn vị nghìn (K).</p>
        </div>

    </div>

    <script>
        // Lấy tham chiếu đến body của bảng
        const tableBody = document.getElementById('tableBody');
        // Định nghĩa các mức tăng giá
        const markups = {
            'gia': 1.10, // +10%
            'npp1': 1.15, // +15%
            'npp2': 1.20, // +20%
            'npp3': 1.30, // +30%
        };
        
        // Trạng thái hiển thị của từng cột, đã thêm npp-manual
        const columnVisibility = {
            'npp-manual': true, 
            'gia': true,
            'npp1': true,
            'npp2': true,
            'npp3': true,
        };
        
        let currentRowId = 0;

        /**
         * Hàm loại bỏ các ký tự không phải số (chỉ giữ lại chữ số).
         * @param {string} value - Giá trị từ ô input.
         * @returns {string} - Chuỗi chỉ chứa chữ số.
         */
        function cleanInput(value) {
            // Đảm bảo value là chuỗi trước khi dùng replace
            return String(value).replace(/[^\d]/g, ''); 
        }

        /**
         * Hàm làm tròn và định dạng số thành chuỗi tiền tệ (ví dụ: 100.000).
         * @param {number} number - Giá trị số cần định dạng.
         * @returns {string} - Chuỗi tiền tệ đã định dạng (hoặc chuỗi rỗng nếu số không hợp lệ).
         */
        function formatPrice(number) {
            // Đảm bảo number là số hợp lệ
            if (typeof number !== 'number' || isNaN(number) || number <= 0) return '';
            
            // Làm tròn tới đơn vị nghìn (K) để đơn giản và dễ đọc
            const roundedNumber = Math.round(number / 1000) * 1000;
            return roundedNumber.toLocaleString('vi-VN');
        }
        
        /**
         * Hàm chuyển đổi chuỗi input đã định dạng thành số nguyên thô.
         * Dùng cho việc lấy giá trị từ input để tính toán.
         * @param {string} value - Giá trị input (có thể đã định dạng).
         * @returns {number} - Giá trị số nguyên thô.
         */
        function getRawNumber(value) {
            const rawValue = cleanInput(value);
            return parseInt(rawValue, 10) || 0;
        }
        
        /**
         * Hàm cập nhật giá trị đã format vào ô input NPP thủ công (không tính toán).
         * @param {number} rowId - ID của dòng.
         */
        function updateNPPManualDisplay(rowId) {
            const nppInput = document.getElementById(`npp-manual-input-${rowId}`);
            if (nppInput) {
                const rawValue = getRawNumber(nppInput.value);
                // Nếu giá trị > 0 thì định dạng, ngược lại thì để rỗng và hiển thị placeholder
                nppInput.value = rawValue > 0 ? formatPrice(rawValue) : '';
                
                // Thêm/Xóa placeholder tùy theo giá trị
                if (rawValue > 0) {
                    nppInput.placeholder = '';
                } else {
                    nppInput.placeholder = 'Nhập giá bán';
                }
            }
        }


        /**
         * Hàm tính toán và cập nhật giá cho một dòng cụ thể.
         * Đã được sửa để xử lý giá trị nhập liệu trước khi tính toán.
         * @param {number} rowId - ID của dòng.
         * @param {boolean} shouldFormat - Có nên định dạng lại giá trị trong ô TK không (nên dùng cho onblur).
         */
        function calculatePrices(rowId, shouldFormat = false) {
            const tkInput = document.getElementById(`tk-input-${rowId}`);
            if (!tkInput) return;
            
            // Lấy giá trị thô, làm sạch từ input
            const tk = getRawNumber(tkInput.value);

            // Chỉ định dạng lại giá trị trong ô TK nếu shouldFormat là true (thường là onblur)
            if (shouldFormat) {
                // Đảm bảo làm tròn và định dạng lại sau khi tính
                tkInput.value = tk > 0 ? formatPrice(tk) : ''; 
            }
            
            if (tk <= 0) {
                // Nếu Giá Gốc không hợp lệ, xóa giá trị ở các cột kết quả
                ['gia', 'npp1', 'npp2', 'npp3'].forEach(key => {
                    const cell = document.getElementById(`${key}-cell-${rowId}`);
                    if (cell) cell.textContent = '';
                });
                return;
            }

            // Tính toán và cập nhật các cột giá theo %
            for (const key in markups) {
                const markup = markups[key];
                const finalPrice = tk * markup;
                const cell = document.getElementById(`${key}-cell-${rowId}`);
                if (cell) {
                    cell.textContent = formatPrice(finalPrice);
                }
            }
        }
        
        /**
         * Hàm ẩn/hiện một cột giá bất kỳ và cập nhật icon.
         * @param {string} key - Mã cột ('npp-manual', 'gia', 'npp1', 'npp2', 'npp3').
         */
        function toggleColumn(key) {
            // Đảo ngược trạng thái hiển thị
            columnVisibility[key] = !columnVisibility[key];
            updateColumnVisibility(key, columnVisibility[key]);
        }

        /**
         * Hàm cập nhật trạng thái hiển thị cho một cột cụ thể.
         * @param {string} key - Mã cột.
         * @param {boolean} isVisible - Trạng thái hiển thị mong muốn (true = hiện, false = ẩn).
         */
        function updateColumnVisibility(key, isVisible) {
            const action = isVisible ? 'remove' : 'add';
            
            // 1. Thao tác với header
            const header = document.getElementById(`header-${key}`);
            if (header) {
                header.classList[action]('hidden-col');
            }
            
            // 2. Thao tác với data cells (Đã thêm cả input cell cho npp-manual)
            const rows = tableBody.getElementsByTagName('tr');
            Array.from(rows).forEach(row => {
                const rowId = row.id.split('-')[1];
                const isInput = (key === 'npp-manual');
                
                // Lấy cell (data cell cho cột tính, hoặc input cell cho cột nhập)
                const cellId = isInput ? `npp-manual-cell-${rowId}` : `${key}-cell-${rowId}`;
                const cell = document.getElementById(cellId);
                
                if (cell) {
                    cell.classList[action]('hidden-col');
                }
            });

            // 3. Cập nhật icon:
            const iconElement = document.getElementById(`icon-${key}`);
            if (iconElement) {
                const button = iconElement.parentElement;
                if (isVisible) {
                    // Icon Mắt Mở (hiện)
                    iconElement.innerHTML = `<path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />`;
                    if(button) button.classList.remove('bg-red-700/50', 'text-red-300'); // Xóa màu đỏ khi ẩn
                    if(button) button.classList.add('bg-emerald-700/50'); // Thêm màu xanh khi hiện
                } else {
                    // Icon Mắt Gạch Chéo (ẩn)
                    iconElement.innerHTML = `<path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l16 16a1 1 0 001.414-1.414l-16-16zM5.933 6.94A10.156 10.156 0 0110 5c4.478 0 8.268 2.943 9.542 7a10.025 10.025 0 01-4.24 3.737l-1.748-1.748A3.978 3.978 0 0014 10a4 4 0 00-4-4 3.978 3.978 0 00-1.748.492l-2.03-2.03zm4.512 8.528l-2.73-2.73A3.993 3.993 0 006 10a4 4 0 004 4 3.993 3.993 0 001.782-.42l2.73 2.73C13.268 15.057 9.542 17 5.058 17a10.156 10.156 0 01-4.24-3.737l1.748-1.748z" clip-rule="evenodd" />`;
                    if(button) button.classList.remove('bg-emerald-700/50'); // Xóa màu xanh khi hiện
                    if(button) button.classList.add('bg-red-700/50', 'text-red-300'); // Thêm màu đỏ khi ẩn
                }
            }
        }
        
        /**
         * Hàm ẩn/hiện tất cả các cột giá.
         * @param {boolean} shouldShow - true để hiện, false để ẩn.
         */
        function toggleAllColumns(shouldShow) {
            const keys = Object.keys(columnVisibility); // Lấy tất cả các cột
            keys.forEach(key => {
                columnVisibility[key] = shouldShow;
                updateColumnVisibility(key, shouldShow);
            });
        }


        // Hàm thêm một dòng mới vào bảng
        function addRow(productCode = 'Nhập mã SP', initialPrice = '') { // Đã đặt giá trị mặc định cho Mã SP và Giá Gốc
            currentRowId++; // Tăng ID cho dòng mới
            const newRow = tableBody.insertRow();
            newRow.id = `row-${currentRowId}`;
            newRow.className = 'hover:bg-gray-50 transition duration-150';

            // Cột STT
            const sttCell = newRow.insertCell();
            sttCell.className = 'col-stt px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 text-center';
            sttCell.textContent = currentRowId;
            
            // Cột MÃ SP (Editable)
            const codeCell = newRow.insertCell();
            codeCell.className = 'col-ma-sp px-3 py-2 whitespace-nowrap text-sm text-gray-500'; 
            codeCell.innerHTML = `
                <input 
                    type="text" 
                    value="${productCode === 'Nhập mã SP' ? '' : productCode}" 
                    class="input-product-code w-full p-1" 
                    placeholder="Nhập mã SP">
                `;

            // Cột NPP (Input)
            const nppManualCell = newRow.insertCell();
            nppManualCell.id = `npp-manual-cell-${currentRowId}`;
            const nppManualHiddenClass = columnVisibility['npp-manual'] ? '' : 'hidden-col'; 
            nppManualCell.className = `col-price px-3 py-2 whitespace-nowrap text-sm text-gray-900 bg-emerald-50/50 ${nppManualHiddenClass}`;
            
            // Giá trị mặc định cho NPP là rỗng
            const nppDefaultValue = '';
            
            nppManualCell.innerHTML = `
                <input 
                    type="text" 
                    id="npp-manual-input-${currentRowId}" 
                    class="input-calculated-price input-npp-editable w-full" 
                    placeholder="Nhập giá bán" 
                    value="${nppDefaultValue}"
                    oninput="this.value = cleanInput(this.value)"
                    onblur="updateNPPManualDisplay(${currentRowId})"
                    onfocus="this.value = cleanInput(this.value)"
                >`;


            // Các cột GIÁ (10%), NPP 1 (15%), NPP 2 (20%), NPP 3 (30%) (Hiển thị kết quả)
            const prices = ['gia', 'npp1', 'npp2', 'npp3'];
            prices.forEach(key => {
                const cell = newRow.insertCell();
                cell.id = `${key}-cell-${currentRowId}`;
                // Áp dụng lớp 'hidden-col' dựa trên trạng thái hiện tại
                const hiddenClass = columnVisibility[key] ? '' : 'hidden-col'; 
                cell.className = `col-price px-3 py-2 whitespace-nowrap text-sm text-gray-900 font-bold text-right bg-emerald-50/50 ${hiddenClass}`; 
                cell.classList.add('input-calculated-price');
            });
            
            // Cột TK (Giá Gốc - Input)
            const tkCell = newRow.insertCell();
            tkCell.className = 'col-price px-3 py-2 whitespace-nowrap text-sm text-gray-900'; 
            tkCell.innerHTML = `
                <input 
                    type="text" 
                    id="tk-input-${currentRowId}" 
                    class="input-tk w-full border-2 rounded-lg p-1 focus:outline-none focus:ring-2 focus:ring-emerald-500" 
                    placeholder="Nhập giá gốc" 
                    value="${formatPrice(initialPrice)}"
                    oninput="this.value = cleanInput(this.value); calculatePrices(${currentRowId}, false)"
                    onblur="calculatePrices(${currentRowId}, true)"
                    onfocus="this.value = cleanInput(this.value)"
                >`;
                
            // Tính toán giá lần đầu (nếu có initialPrice)
            if (initialPrice) {
                calculatePrices(currentRowId, true);
            }


            // Cột Thao tác (Xóa dòng)
            const actionCell = newRow.insertCell();
            actionCell.className = 'col-action px-3 py-2 whitespace-nowrap text-center';
            actionCell.innerHTML = `
                <button onclick="deleteRow(${currentRowId})" class="text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-100 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                </button>
            `;
            
            // Cập nhật lại STT của tất cả các dòng sau khi thêm
            updateRowNumbers();
        }

        // Hàm xóa một dòng
        function deleteRow(rowId) {
            const row = document.getElementById(`row-${rowId}`);
            if (row) {
                row.remove();
                // Cập nhật lại STT của tất cả các dòng
                updateRowNumbers();
            }
        }
        
        // Hàm cập nhật lại STT (Serial Number)
        function updateRowNumbers() {
            const rows = tableBody.getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                const sttCell = rows[i].cells[0]; // Ô đầu tiên là STT
                if (sttCell) {
                    sttCell.textContent = i + 1;
                }
            }
        }

        // Khởi tạo bảng với 3 dòng sản phẩm trống
        window.onload = function() {
            // Thêm 3 dòng trống vào bảng
            for (let i = 0; i < 3; i++) {
                addRow('Nhập mã SP', ''); // Mã SP mặc định và giá gốc rỗng
            }
            
            // Đảm bảo trạng thái icon khớp với trạng thái hiển thị
            Object.keys(columnVisibility).forEach(key => {
                updateColumnVisibility(key, columnVisibility[key]);
            });
        };
    </script>
</body>
</html>
